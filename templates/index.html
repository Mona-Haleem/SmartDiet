{% extends "layout.html" %}
{% load static %}

{% block script %}
<link rel="stylesheet" href="{% static 'home/styles.css' %}">
<script defer type="module" src="{% static 'home/script.js' %}"></script>
{% endblock %}

{% block body %}
<input type="hidden" id="csrf_token" value="{{ csrf_token }}">

<div class="book-container" 
     x-data="{
       home: true,
       editMode: false,
       user:{{user}},
       currentView: 'day',
       selectedDate: new Date().toISOString().split('T')[0],
       selectedPlanType: 'diet',
       selectedPlan: null,
       selectedPeriod: 'day',
       showLeftPage: true,
       isMobile: window.innerWidth < 992,
       allPlans: {{allPlans}},
       todayPlans:{{todayPlans}},
       showAddForm:false,
     }"
     x-init="
       window.addEventListener('resize', () => {
         isMobile = window.innerWidth < 992;
       });
     ">

  <!-- Left Page: Profile & Plans -->
  <div id="left-page" 
       class="book-page left-page" 
       :class="{ 'hidden': isMobile && !showLeftPage }"
       x-data="homeManager"
       x-init="$nextTick(() => homeManager = new HomeManager($el, $refs, $data))">
       {% include "components/profile/header.html" %}
    
    <div class="book-page" style="width: 100%; height: 100%">
      <h2 style="color: rgb(var(--accent-color-rgb))">Current Plans</h2>
      <div class="pl-2">
        {% include "components/home/todayPlan.html" with plan=todayPlans.diet type='diet' %}
        {% include "components/home/todayPlan.html" with plan=todayPlans.exercise type='exercise' %}
      </div>
    </div>
  </div>

  <!-- Right Page: Progress Tracking -->
  <div class="book-page right-page" 
       :class="{ 'hidden': isMobile && showLeftPage }">
    <div class="progress-page-wrapper">
      {% include 'components/progress/progressHeader.html' %}
      
      <div class="progress-content">
        {% include "components/progress/dayProgress.html" %}  
      </div>
    </div>
  </div>

  <!-- Mobile Toggle Button -->
  <button class="page-toggle-btn" 
          x-show="isMobile"
          @click="showLeftPage = !showLeftPage"
          :aria-label="showLeftPage ? 'Show Progress' : 'Show Plans'">
    <i class="fas" :class="showLeftPage ? 'fa-chart-line' : 'fa-calendar-alt'"></i>
  </button>
  {% include "components/browser/creationForm.html" %} 

</div>

{% endblock %}